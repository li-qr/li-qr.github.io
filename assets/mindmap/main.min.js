angular.module("kityminderDemo",["kityminderEditor"]).config(function(configProvider){configProvider.set("imageUpload","../server/imageUpload.php")}).controller("MainController",function($scope){function listenContentChange(){listenContentChange.listened||(window.minder.on("contentchange",function(e){".svg"===window.fileExtName?window.minder.exportData("svg").then(function(data){window.vscode.postMessage({command:"draft",exportData:data})}):window.vscode.postMessage({command:"draft",exportData:JSON.stringify(window.minder.exportJson(),null,4)})}),listenContentChange.listened=!0)}$scope.initEditor=function(editor,minder){window.editor=editor,window.minder=minder,window.addEventListener("message",function(event){window.message=event.data;var _window$message=window.message,command=_window$message.command,extName=_window$message.extName;switch(window.fileExtName=extName,command){case"import":var importTask=Promise.resolve();try{importTask=importTask.then(function(){var importData=window.message.importData;if(".svg"===extName)return new Promise(function(resolve){window.minder.importData("svg",importData).then(resolve,resolve)});window.minder.importJson(JSON.parse(importData||"{}"))})}catch(ex){console.error(ex)}importTask.then(listenContentChange,listenContentChange)}}),window.addEventListener("keydown",function(e){var keyCode=e.keyCode||e.which||e.charCode;(e.ctrlKey||e.metaKey)&&83===keyCode&&document.querySelector(".km-export-save").click()}),window.minder.on("click",function(e){try{var link=e.minder.queryCommandValue("HyperLink");link&&link.url&&"HyperLink"===e.kityEvent.targetShape.container.getType()&&window.vscode.postMessage({command:"clicklink",link:link.url})}catch(e){}}),window.vscode.postMessage({command:"loaded"})}});
