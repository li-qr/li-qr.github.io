---
title: B树
categories:
- 数据结构
- algorithm
description: 在计算机科学中，B树是一种自平衡的树形数据结构，它可以保持数据的顺序，并允许在对数时间内进行搜索、顺序访问、插入和删除。
permalink: "/posts/b-tree"
excerpt: 在计算机科学中，B树是一种自平衡的树形数据结构，它可以保持数据的顺序，并允许在对数时间内进行搜索、顺序访问、插入和删除。B树概括了二进制搜索树，允许节点有两个以上的子节点。与其他自平衡二进制搜索树不同，B树很适合用于读写相对较大的数据块的存储系统，如磁盘。它通常被用于数据库和文件系统中。
---

+[Wiki](https://en.wikipedia.org/wiki/B-tree)

在计算机科学中，B树是一种自平衡的树形数据结构，它可以保持数据的顺序，并允许在对数时间内进行搜索、顺序访问、插入和删除。B树概括了二进制搜索树，允许节点有两个以上的子节点。与其他自平衡二进制搜索树不同，B树很适合用于读写相对较大的数据块的存储系统，如磁盘。它通常被用于数据库和文件系统中。

B树是在波音研究室中被发明出来的，目的是为了有效管理大型随机访问文件的索引页。基本的假设是，索引的数量非常大，以至于只有小块的树可以放在主内存中。相关论文[Organization and maintenance of large ordered indices](/assets/pdf/BayerBTree-72.pdf)。作者从未解释过 `B` 代表什么。“你越是思考B树中的B是什么意思，你就能越理解B树”。

## 定义

根据定义，一个阶数为 `m` 的B树具有以下属性：
1. 每个节点最多有 m 个子节点（子树）
2. 除了根节点外，每个非叶子节点最少有 m/2 个子节点（子树）
3. 根节点至少有 2 个子节点（子树）（除非B树只有一个节点）
4. 一个有 k 个子节点的非叶子节点包含 k-1 个键
5. 所有叶子节点都在同一层级，且不携带任何信息

每个内部节点的键作为分隔值划分其子树。例如一个内部节点有 3 个子节点（或子树），那么它必须有两个键：$$a_1$$ 和 $$a_2$$。最左边的子树中所有值都小于 $$a_1$$，中间的子树中所有值都介于 $$a_1$$ 和 $$a_2$$ 之间，右边的子树中所有值都大于 $$a_2$$。

内部节点
: 内部节点是除叶子节点和根节点以外的所有节点。它的结构通常包含一个有序的元素集合，和子节点指针。每个内部节点最多包含 U 个子女，最少包含 L 个子女。因此，元素的数量总是比子指针的数量少1（元素的数量在 L-1 和 U-1 之间）。U 必须是 2L 或 2L-1 ；因此每个内部节点至少有一半是满的。U 和 L 之间的关系意味着两个半满的节点可以被连接成一个合法的节点，一个满的节点可以被分割成两个合法的节点（需要将一个元素推送到父节点上，如果父节点没有空间则向上递归）。这些属性使我们有可能在 B 树中删除和插入新的数值时以较小的成本调整树以保留 B 树的属性。

根节点
: 根节点的子节点数量有和内部节点一样的上限，但没有下限。

叶子节点
: 叶子节点不携带任何信息。比叶子高一级的内部节点只存储键（最多是m-1，如果不是根至少是m/2-1）和指向不携带任何信息的节点的指针。

一个深度为 n+1 的B树可以容纳大约 U 倍于深度为 n 的B树的项目，但是搜索、插入和删除操作的成本会随着树的深度增长。与任何平衡树一样，成本的增长比元素的数量要慢得多。有些平衡树只在叶子节点上存储数值，并且叶子节点和内部节点使用两种类型。而B树在树中的每一个节点上都保留数值，除了叶子节点。

B树的`阶`有的定义为内部节点可存储的最少键值的数量；有些地方定义为内部节点可存储的最大子节点数量。