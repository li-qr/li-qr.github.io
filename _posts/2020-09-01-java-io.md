---
title: jdk源码rt.jar中java.io包拆解
categories:
- jdk
- rt.jar
- java
- io
description: jdk源码rt.jar中java.io包拆解、详解
permalink: "/posts/jdk-rt-jar-java-io"
excerpt: AutoCloseable、Closeable、InputStream/OutputStream、Reader/Writer、DataInput/DataOutput、ObjectInput/ObjectOutput、RandomAccessFile、IOException、IOError、File
---

# 概览

![java.io包UML图class](/assets/images/java-io/java-io-class.svg)

`java.io` 包中有输入输出流 `InputStream/OutputStream` ，字符输入输出 `Reader/Writer` ，全部实现了 `Closeable.close()` 方法。`Closeable` 接口又继承自用来实现Java `try-with-resource` 的 `AutoCloseable` 接口。还有从二进制流中的字节读取、写入java基本数据类型的 `DataInput/DataOutput` ,以及继承了 `DataInput/DataOutput` 用于读取写入Java对象、数组、字符串的接口 `ObjectInput/ObjectOutput` 。还有文件类 `File` ,随机读写文件类 `RabdomAccessFile` 。异常类 `IOException/IOError`。

# 接口

![java.io包UML图interface](/assets/images/java-io/java-io-interface.svg)

`java.io` 包下所有IO流和字符流都实现了 `AutoCloseable` 接口，但是注意 `AutoCloseable` 接口位于 `java.lang` 包下。对于IO流和字符流这种在关闭之前可以保存资源（例如文件或套接字句柄）的对象。当退出在资源规范头中已声明该对象的 `try-with-resources` 块时，将自动调用 `AutoCloseable.close()` 方法。这种构造可确保及时释放，避免资源耗尽异常和可能发生的错误。虽然 `AutoCloseable.close()` 方法声明中返回的是 `Exception` 异常，但是 javadoc 中要求实现者准确的异常类，或者不抛出异常。close 操作存在失败的可能，而 `close()` 方法正常只会被调用一次，所以实现者应该在抛出异常之前释放持有的资源，并在实现内部标记资源为已关闭，这样做可以确保资源被及时释放。实现者也不要在 `close()` 方法中抛出 `InterruptedException` 异常， 这个异常会与线程的中断状态相互作用引发运行时行为的异常。并且如果 `close()` 方法中出现了 `InterruptedException` 异常，实现者不应该继续向外抛出。`AutoCloseable.close()` 与 `Closeable.close()` 方法不同，前者不是幂等的，多次调用会有副作用，而后者是幂等的，大于一次的调用无效。所以建议 `AutoCloseable.close()` 的实现者在实现 `close()` 方法时实现幂等。

`Closeable` 接口表示可以关闭目标资源的数据，在调用 `close()` 方法时放弃持有的资源。如果流已经关闭，则调用 `Closeable.close()` 无效。在抛出IOException之前，应该放弃基础资源，并在内部将Closeable标记为已关闭。

`Flushable` 是可刷新数据的目标。调用 `flush()` 方法将输出到缓冲区中的数据写入底层流。



# InputStream/Reader

![java.io包UML图input](/assets/images/java-io/java-io-input.svg)

# OutputStream/Writer

![java.io包UML图output](/assets/images/java-io/java-io-output.svg)

# RandomAccessFile

![java.io包UML图randomaccess](/assets/images/java-io/java-io-randomaccess.svg)

# 概览方法图

![java.io包UML图method](/assets/images/java-io/java-io-with-method.svg)