---
title: 从Paxos到ZooKeeper分布式一致性原理与实践摘要
categories:
- ZooKeeper
- JAVA
- 分布式
description: 从Paxos到ZooKeeper分布式一致性原理与实践摘要
permalink: "/posts/from-paxos-to-zookeeper"
excerpt: 内容全部源自《从Paxos到ZooKeeper分布式一致性原理与实践》，取自里面的重点内容摘要。包括分布式架构、一致性协议、ZooKeeper与Paxos、ZooKeeper典型使用场景等。
---

# 分布式架构

## 从集中式到分布式

### 集中式的特点

集中式系统部署结构简单，无须分布式协作问题

### 分布式的特点

分布式系统的定义——《分布式系统概念与设计》

> 分布式系统是一个硬件或软件组件分布在不同的网络计算机上，彼此之间仅仅通过消息传递进行通信和协调的系统。

一个标准的分布式系统在没有任何特定业务逻辑约束的情况下，会有如下几个特征：

+ 分布性 分布式系统中的多台计算机都会在空间上随意分布，同时机器的分布情况也会随意变动。
+ 对等性 分布式系统中的计算机没有主从之分，这里面的主从是指没有控制整个系统的主机也没有被控制的主机。
+ 并发性 多个节点并发操作共享资源
+ 缺乏全局时钟 分布式系统缺乏全局的时钟序列控制
+ 故障总是会发生 
  
### 分布式环境的各种问题

+ 通信异常
+ 网络分区
+ 三态（成功、失败、与超时）
+ 节点故障

## 从ACID到CAP/BASE

### ACID

事务可以在并发情况下提供一个隔离方法以防止互相干扰。并且为数据库提供了一个从失败中恢复的方法，和数据库即使在异常状态下仍能保持数据一致性的方法。

### 分布式事务

由于在分布式环境中会出现[各种问题](/posts/from-paxos-to-zookeepe#分布式环境的各种问题)，所以需要分布式事务。

分布式事务是指事务的参与者、支持事务的服务器、资源服务器一级事务管理器分布在分布式环境中。通常可以把一系列分布式操作序列称为子事务，因此分布式事务也可以被定义为一种嵌套型事务，同时也具有了ACID属性。

### CAP和BASE理论

ACID在分布式环境严格的一致性难以保证可用性，因此出现了CAP和BASE理论。

#### CAP

C-一致性(Consistency)，A-可用性(Availability)，P-分区容错性(Partition tolerance)。一个分布式系统最多只能满足其中两项。

##### 一致性

分布式系统中的一致性指多个副本之间能否保持一致的特性。对一个节点的更新同步到其他节点。

##### 可用性

可用性指对用户的每一个请求总是能在有限的时间内返回结果。重点在于有限的时间和返回结果。有限时间指一个合理的返回时间；返回结果是指一个明确是成功或失败的结果。

##### 分区容错性

分布式系统在遇到任何*网络分区*故障的时候，仍然需要保证对外提供一致性和高可用性服务，除非是整个网络环境的故障。*网络分区*指不同子网络之间出现无法联通的情况，但子网络内正常，导致网络环境被切分成若干孤立区域。

| 放弃其中之一 | 说明 |
| :---:| :---: |
| 放弃P | 一种较为简单的方法是把所有的数据都放到一个节点上，同时也放弃了可扩展性 |
| 放弃A | 一旦遇到网络分区或其他故障时服务需要停止一段时间 |
| 放弃C | 放弃强一致性保留最终一致性 |

对于分布式系统来说，P(分区容错性)是一个基本的要求，因此根据业务点一般在C和A直接寻求平衡。

